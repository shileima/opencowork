---
name: 项目视图功能实现
overview: 在 QACowork 应用中添加"项目"tab，实现全屏四区域布局：任务列表、聊天交互、多tab编辑器（Monaco）、资源管理器，支持项目创建、文件管理和代码编辑。
todos:
  - id: install-deps
    content: 安装依赖：@monaco-editor/react, monaco-editor, xterm, xterm-addon-fit
    status: completed
  - id: project-store
    content: 创建 ProjectStore.ts 管理项目元信息和任务列表
    status: completed
  - id: ipc-handlers
    content: 在 main.ts 添加项目、文件系统、终端的 IPC handlers
    status: completed
  - id: preload-update
    content: 更新 preload.ts 暴露新的 IPC 接口
    status: completed
  - id: app-navigation
    content: 在 App.tsx 添加项目 tab 导航
    status: completed
  - id: project-view
    content: 创建 ProjectView.tsx 主组件，实现四区域布局
    status: completed
  - id: task-panel
    content: 创建 TaskListPanel.tsx，实现任务列表和项目切换，支持隐藏/显示（快捷键 ⇧^T）
    status: completed
  - id: chat-panel
    content: 创建 ChatPanel.tsx，集成聊天功能
    status: completed
  - id: multi-tab-editor
    content: 创建 MultiTabEditor.tsx，实现多tab切换（编辑器/终端/智能体）
    status: completed
  - id: monaco-editor
    content: 创建 MonacoEditor.tsx，集成 Monaco Editor
    status: completed
  - id: terminal
    content: 创建 Terminal.tsx，集成 xterm.js
    status: completed
  - id: file-explorer
    content: 创建 FileExplorer.tsx，实现树形文件管理
    status: completed
  - id: project-dialog
    content: 创建 ProjectCreateDialog.tsx，项目创建对话框
    status: completed
  - id: i18n
    content: 添加国际化翻译
    status: completed
  - id: styling
    content: 实现响应式布局和暗色主题支持
    status: completed
isProject: false
---

# 项目视图功能实现计划

## 功能概述

在现有应用中添加"项目"tab，实现类似 TRAE CN 的全屏IDE界面，包含四个功能区域。

## 架构设计

### 布局结构

```
┌─────────────────────────────────────────────────────────┐
│  Header (导航栏: 对话/协作/项目)                        │
├──────────┬──────────────────────┬───────────────────────┤
│ 区域一   │  区域二              │  区域三               │
│ 任务列表 │  聊天交互            │  多Tab编辑器          │
│          │                      │  (编辑器/终端/智能体) │
│          ├──────────────────────┤                       │
│          │                      │                       │
│          │                      │                       │
├──────────┴──────────────────────┴───────────────────────┤
│  区域四: 资源管理器 (右侧)                              │
└─────────────────────────────────────────────────────────┘
```

## 实现步骤

### 1. 依赖安装

- 安装 `@monaco-editor/react` 和 `monaco-editor`
- 安装 `xterm` 和 `xterm-addon-fit`（终端支持）

### 2. IPC 接口扩展 (`electron/main.ts`)

添加以下 IPC handlers：

- `project:create` - 创建新项目（目录+名称）
- `project:list` - 获取项目列表
- `project:open` - 打开项目
- `project:get-current` - 获取当前项目
- `project:task:create` - 创建任务（初始化新聊天）
- `project:task:list` - 获取任务列表
- `project:task:switch` - 切换任务
- `fs:read-file` - 读取文件内容
- `fs:write-file` - 写入文件
- `fs:list-dir` - 列出目录
- `fs:create-dir` - 创建目录
- `fs:rename` - 重命名文件/文件夹
- `fs:delete` - 删除文件/文件夹
- `terminal:create` - 创建终端会话
- `terminal:write` - 向终端写入
- `terminal:resize` - 调整终端大小

### 3. 项目存储管理 (`electron/config/ProjectStore.ts`)

- 使用 `electron-store` 存储项目元信息
- 存储结构：`{ projects: [{ id, name, path, createdAt, tasks: [...] }] }`
- 项目路径直接使用本地文件系统

### 4. 组件实现

#### 4.1 导航栏更新 (`src/App.tsx`)

- 在现有"对话"、"协作"tab后添加"项目"tab
- 添加 `activeView` state 管理当前视图

#### 4.2 ProjectView 主组件 (`src/components/ProjectView.tsx`)

- 全屏布局，包含四个区域
- 管理项目状态、当前任务、编辑器tabs
- 处理项目创建对话框
- **任务列表隐藏状态管理**：
  - 维护 `isTaskPanelHidden` state
  - 监听快捷键 `Shift+Ctrl+T` / `Shift+Cmd+T`
  - 隐藏状态持久化
  - 布局响应式调整（隐藏时其他区域扩展）

#### 4.3 TaskListPanel (`src/components/project/TaskListPanel.tsx`)

- 区域一：左侧任务列表
- 显示项目列表（下拉选择）
- 显示当前项目的任务列表
- "新任务"按钮创建任务并初始化新聊天
- 任务项显示：标题、状态、时间
- **隐藏/显示功能**：
  - 顶部添加"隐藏任务"按钮（图标+文字）
  - 快捷键支持：`Shift+Ctrl+T` (Windows/Linux) 或 `Shift+Cmd+T` (macOS)
  - 隐藏时面板宽度设为 0，其他区域自动扩展
  - 隐藏状态持久化到 localStorage
  - 隐藏后可通过快捷键或悬停显示按钮恢复

#### 4.4 ChatPanel (`src/components/project/ChatPanel.tsx`)

- 区域二：聊天交互区域
- 复用现有 `ChatInput` 组件
- 显示当前任务的聊天历史
- 与 AgentRuntime 集成

#### 4.5 MultiTabEditor (`src/components/project/MultiTabEditor.tsx`)

- 区域三：多tab编辑器
- Tab类型：编辑器、终端、智能体
- Tab管理：打开、关闭、切换
- 编辑器使用 Monaco Editor
- 终端使用 xterm.js
- 智能体tab显示AI响应流

#### 4.6 FileExplorer (`src/components/project/FileExplorer.tsx`)

- 区域四：右侧资源管理器
- 树形结构展示项目文件
- 功能：新建文件/文件夹、重命名、删除、刷新、折叠展开
- 点击文件在编辑器中打开
- 右键菜单支持操作

#### 4.7 MonacoEditor 包装 (`src/components/project/MonacoEditor.tsx`)

- 封装 Monaco Editor
- 支持 TypeScript、JavaScript、Markdown、React 等语法高亮
- 文件变更检测和保存

#### 4.8 Terminal 组件 (`src/components/project/Terminal.tsx`)

- 封装 xterm.js
- 与主进程终端会话通信
- 支持命令执行和输出显示

### 5. 样式和布局

- 使用 Tailwind CSS 实现响应式布局
- 区域大小可调整（resizable panels）
- 支持暗色主题
- 参考 TRAE CN 的视觉风格
- **任务列表隐藏功能**：
  - 使用 CSS transition 实现平滑的显示/隐藏动画
  - 隐藏时任务面板宽度为 0，其他区域使用 flex-grow 自动扩展
  - 隐藏状态下，在左侧边缘悬停可显示临时按钮恢复面板

### 6. 国际化 (`src/i18n/translations.ts`)

添加翻译：

- `project` - 项目
- `newProject` - 新建项目
- `projectName` - 项目名称
- `projectPath` - 项目路径
- `createProject` - 创建项目
- `tasks` - 任务
- `newTask` - 新任务
- `editor` - 编辑器
- `terminal` - 终端
- `agent` - 智能体
- `fileExplorer` - 资源管理器
- `newFile` - 新建文件
- `newFolder` - 新建文件夹
- `rename` - 重命名
- `delete` - 删除
- `refresh` - 刷新
- `hideTaskList` - 隐藏任务
- `showTaskList` - 显示任务

## 文件清单

### 新增文件

- `src/components/ProjectView.tsx` - 主视图组件
- `src/components/project/TaskListPanel.tsx` - 任务列表面板
- `src/components/project/ChatPanel.tsx` - 聊天面板
- `src/components/project/MultiTabEditor.tsx` - 多tab编辑器
- `src/components/project/FileExplorer.tsx` - 资源管理器
- `src/components/project/MonacoEditor.tsx` - Monaco编辑器包装
- `src/components/project/Terminal.tsx` - 终端组件
- `src/components/project/ProjectCreateDialog.tsx` - 项目创建对话框
- `electron/config/ProjectStore.ts` - 项目存储管理

### 修改文件

- `src/App.tsx` - 添加项目tab导航
- `src/i18n/translations.ts` - 添加翻译
- `electron/main.ts` - 添加IPC handlers
- `electron/preload.ts` - 暴露新的IPC接口
- `package.json` - 添加依赖

## 技术要点

1. **Monaco Editor集成**
  - 使用 `@monaco-editor/react` 简化集成
  - 配置语言支持（TypeScript、JavaScript、Markdown等）
  - 实现文件变更检测和自动保存
2. **终端实现**
  - 使用 xterm.js 创建终端界面
  - 在主进程创建子进程执行命令
  - 通过IPC传递输入输出
3. **文件系统操作**
  - 所有文件操作通过IPC到主进程
  - 权限检查复用现有 PermissionManager
  - 错误处理和用户提示
4. **状态管理**
  - 使用 React state 管理项目、任务、编辑器tabs
  - 项目元信息持久化到 electron-store
  - 任务与session系统集成
5. **性能优化**
  - 大文件使用虚拟滚动
  - 编辑器懒加载
  - 文件树按需加载

