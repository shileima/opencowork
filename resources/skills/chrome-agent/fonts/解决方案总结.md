# PDF 中文乱码问题 - 解决方案总结

## ✅ 已完成的工作

1. **修复了 `weibo-scraper.js` 脚本**
   - 添加了中文字体查找功能
   - 优化了字体加载逻辑
   - 添加了详细的错误提示

2. **更新了 PDF 技能文档**
   - 在 `resources/skills/pdf/reference.md` 中添加了 pdfkit 中文字体支持说明
   - 提供了完整的代码示例和最佳实践

3. **创建了字体下载指南**
   - `fonts/浏览器下载说明.md` - 浏览器下载步骤
   - `fonts/直接下载链接.md` - 直接下载链接
   - `fonts/下载指南.md` - 多种下载方法

4. **安装了 NotoSansCJK 字体**
   - 通过 Homebrew 安装了 NotoSansCJK (TTC 格式)
   - 位置：`~/Library/Fonts/NotoSansCJK.ttc`

## ⚠️ 当前问题

1. **pdfkit 不支持 TTC 格式**
   - Homebrew 安装的是 TTC（TrueType Collection）
   - pdfkit 只支持 TTF/OTF 格式

2. **命令行工具无法访问 GitHub**
   - 即使连接了 VPN，curl/node 等工具仍无法访问
   - 需要浏览器手动下载

3. **字体提取遇到技术问题**
   - fontkit 提取 TTC 字体时出现错误
   - 需要直接下载 TTF 文件

## 🎯 最终解决方案

### 使用浏览器下载（推荐）

1. **打开浏览器**（确保已连接 VPN）

2. **访问 GitHub Releases**：
   ```
   https://github.com/notofonts/noto-cjk/releases
   ```

3. **找到正确的文件**：
   - 查找 "Sans" 版本的 releases（不是 Serif）
   - 在 Assets 列表中找到 **"Subset TTF"** 部分
   - 下载：`NotoSansCJK-Regular.ttf` 或 `NotoSansCJK-SC-Regular.ttf`
   - ⚠️ **必须下载 TTF 格式，不要下载 TTC**

4. **放置文件**：
   将下载的 `.ttf` 文件放到：
   ```
   ~/.qa-cowork/skills/chrome-agent/fonts/
   ```

5. **验证**：
   ```bash
   cd ~/.qa-cowork/skills/chrome-agent
   node test-pdf-chinese.js
   ```
   
   如果看到：
   ```
   ✅ 已加载中文字体: /path/to/NotoSansCJK-SC-Regular.ttf
   ```
   说明成功！

## 📝 直接下载链接（浏览器中使用）

如果 releases 页面加载缓慢，可以在浏览器中直接访问：

**简体中文 Regular**：
```
https://github.com/notofonts/noto-cjk/raw/main/Sans/Subset/TTF/SC/NotoSansCJKsc-Regular.ttf
```

**完整版本 Regular**：
```
https://github.com/notofonts/noto-cjk/raw/main/Sans/Subset/TTF/NotoSansCJK-Regular.ttf
```

## ✅ 完成后的效果

下载并放置 TTF 字体文件后：

1. **运行测试脚本**：
   ```bash
   cd ~/.qa-cowork/skills/chrome-agent
   node test-pdf-chinese.js
   ```
   应该看到 "✅ 已加载中文字体"

2. **运行微博爬虫脚本**：
   ```bash
   node weibo-scraper.js
   ```
   生成的 PDF 将正确显示中文，不再出现乱码

## 🔍 验证文件

下载后验证文件是否正确：

```bash
cd ~/.qa-cowork/skills/chrome-agent/fonts

# 检查文件是否存在
ls -lh NotoSansCJK-SC-Regular.ttf

# 检查文件格式（应该显示 "TrueType font"）
file NotoSansCJK-SC-Regular.ttf

# 检查文件大小（应该约 2-10 MB）
du -h NotoSansCJK-SC-Regular.ttf
```

## 📚 相关文档

- `fonts/浏览器下载说明.md` - 详细的浏览器下载步骤
- `fonts/直接下载链接.md` - 直接下载链接列表
- `fonts/下载指南.md` - 多种下载方法
- `fonts/QUICK_START.md` - 快速开始指南

## 🆘 需要帮助？

如果下载后仍有问题：

1. 检查文件格式：`file fonts/NotoSansCJK-SC-Regular.ttf`
2. 检查文件大小：应该约 2-10 MB
3. 检查文件权限：确保文件可读
4. 查看脚本日志：运行时会显示找到的字体路径
