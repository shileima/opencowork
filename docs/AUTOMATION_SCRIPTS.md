# 自动化脚本使用指南

## 脚本存储位置

自动化脚本存储在以下目录：

**macOS/Linux**: `~/.qa-cowork/skills/chrome-agent/`  
**Windows**: `%USERPROFILE%\.qa-cowork\skills\chrome-agent\`

## 如何添加新脚本

### 方法1：直接在脚本目录创建文件

1. **打开脚本目录**：
   - 在自动化脚本下拉列表中，点击文件夹图标（📁）打开脚本目录
   - 或者手动导航到 `~/.qa-cowork/skills/chrome-agent/`

2. **创建脚本文件**：
   - 在目录中创建新的 `.js` 文件
   - 文件名将作为脚本名称显示在列表中
   - 例如：`my_script.js` → 显示为 "my_script"

3. **刷新列表**：
   - 脚本列表会自动每 5 秒刷新一次
   - 也可以点击刷新按钮（🔄）手动刷新

### 方法2：通过代码生成

使用 AI 助手生成脚本后，确保脚本文件保存在 `~/.qa-cowork/skills/chrome-agent/` 目录下。

## 脚本命名规则

- 文件名必须以 `.js` 结尾
- 脚本名称 = 文件名（不含 `.js` 扩展名）
- 例如：`login_xgpt.js` → 脚本名称 "login_xgpt"

## 脚本列表刷新

### 自动刷新
- 当自动化脚本下拉列表打开时，每 5 秒自动刷新一次
- 新添加的脚本会在下次刷新时自动出现

### 手动刷新
- 点击下拉列表右上角的刷新按钮（🔄）
- 立即刷新脚本列表

### 打开脚本目录
- 点击文件夹图标（📁）打开脚本存储目录
- 方便查看和编辑脚本文件

## 常见问题

### Q: 新建的脚本没有出现在列表中？

**可能原因和解决方法**：

1. **脚本文件位置不正确**
   - ✅ 确保脚本文件在 `~/.qa-cowork/skills/chrome-agent/` 目录下
   - ✅ 点击文件夹图标打开目录，检查文件位置

2. **文件扩展名不正确**
   - ✅ 确保文件以 `.js` 结尾
   - ✅ 例如：`my_script.js` ✅，`my_script` ❌

3. **列表未刷新**
   - ✅ 等待 5 秒自动刷新
   - ✅ 或点击刷新按钮（🔄）手动刷新
   - ✅ 关闭并重新打开自动化脚本下拉列表

4. **文件权限问题**
   - ✅ 确保文件有读取权限
   - ✅ 检查文件是否被其他程序锁定

### Q: 如何查看脚本目录路径？

1. 在自动化脚本下拉列表中点击文件夹图标（📁）
2. 或在设置 → 目录管理 → 查看 `scriptsDir` 路径

### Q: 脚本文件应该放在哪里？

**正确位置**：
```
~/.qa-cowork/skills/chrome-agent/my_script.js
```

**错误位置**（不会被识别）：
```
~/.qa-cowork/skills/my_script.js          ❌ 应该在 chrome-agent 子目录
~/Desktop/my_script.js                    ❌ 不在应用目录
~/.qa-cowork/my_script.js                ❌ 不在正确的子目录
```

### Q: 如何验证脚本是否被识别？

1. 打开自动化脚本下拉列表
2. 检查脚本是否出现在列表中
3. 如果不在，检查：
   - 文件路径是否正确
   - 文件扩展名是否为 `.js`
   - 点击刷新按钮

### Q: 脚本列表显示的是什么时候的数据？

- 脚本列表每次打开时都会从文件系统重新扫描
- 列表会显示目录中所有 `.js` 文件
- 按最后修改时间排序（最新的在前）

## 脚本管理功能

### 普通用户
- ✅ 可以执行所有脚本
- ✅ 可以查看脚本列表
- ❌ 不能删除脚本
- ❌ 不能重命名脚本
- ❌ 不能标记为官方

### 超级管理员
- ✅ 所有普通用户权限
- ✅ 可以删除用户脚本
- ✅ 可以重命名脚本
- ✅ 可以标记脚本为官方
- ✅ 可以管理预设管理员列表

## 官方脚本

官方脚本具有以下特性：
- 显示"官方"标识
- 不能被普通用户删除
- 随应用分发给所有用户
- 存储在 `resources/skills/chrome-agent/` 目录

## 技术细节

### 脚本扫描逻辑

1. **目录扫描**：`ScriptStore.syncScriptsFromDirectory()` 扫描脚本目录
2. **文件过滤**：只识别 `.js` 文件
3. **元数据提取**：读取文件修改时间、创建时间
4. **官方标记**：检查 `official-scripts.json` 判断是否为官方脚本
5. **列表更新**：更新到 `electron-store` 并返回给前端

### 脚本同步时机

- 应用启动时
- 调用 `script:list` IPC handler 时
- 每次都会重新扫描目录，确保最新

### 文件系统监听（未来改进）

目前脚本列表通过定时刷新和手动刷新更新。未来可以考虑添加文件系统监听（如 `chokidar`）来自动检测文件变化。

## 相关文件

- `electron/config/ScriptStore.ts`：脚本存储和管理逻辑
- `electron/config/DirectoryManager.ts`：目录路径管理
- `src/components/CoworkView.tsx`：自动化脚本 UI
- `resources/skills/chrome-agent/official-scripts.json`：官方脚本清单
